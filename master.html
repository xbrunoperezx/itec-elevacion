<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta name="robots" content="noindex, nofollow">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Librería XLS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.5/xlsx.full.min.js"></script>
    <!-- Materialize CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- Importación de Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Tu propio CSS personalizado -->
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <title>SGASTUR - SGA Elevación 2</title>
  
</head>
<body>
    <!--creamos un contenedor para poder dibujar o escribir dentro de el con  una clase y una id (resultado sera el pincel)-->
    <div class="container" id="resultado">
        <h5>Clientes</h5>
    </div>

    <!--Creamos el "contenedor" donde pintaremos la tabla con el JS-->
    <table class="none">
        <thead>
            <tr>
                <td>#</td>
                <td>Nombre</td>
                <td>Direccion</td>
                <td>Localidad</td>
                <td>Cp</td>
                <td>Acciones</td>
            </tr>
        </thead>

        <tbody id="tabla-clientes"> <!--el pincel con el que pintaremos ahroa sera "tabla-clientes"-->
            <!--aqui con este id es en el que con la funcion en JS isnertaremos todos los clientes-->
        </tbody>
    </table>

    <!--Creamos al estructura completa del modal-->
    <div id="modal-cliente" class="modal">
        <div class="modal-content">
            <h4>Detalles del cliente</h4>

            <p><strong>Nombre:</strong><span id="m-nombre"></span></p>
            <p><strong>Direccion:</strong><span id="m-direccion"></span></p>
            <p><strong>Localidad:</strong><span id="m-localidad"></span></p>
            <p><strong>CP:</strong><span id="m-cp"></span></p>

        </div>

        <div class="modal-footer">
            <a href="#!" class="modal-close btn grey">Cerrar</a>
        </div>
    </div>


    
    <!--Scrip de peticion back via ajax-->
    <script>
        //creamos una variable acessible desde cualquier punto del programa
        let clientesGlobal=[];
        $(document).ready(function(){  //cargamos la web (el JS) nada mas acceder a la Url
            $.ajax({ //aqui hacemos la peticion de los datos al back (ajax no recarga la pagina)
                //donde lo llamo 
                type:"POST",
                //como lo llamo
                url:"services/clientes.php", 
                //que mando
                data:{  
                    filtro_total: 15
                },
                //que hago cuando vuelve? ->successs/error
                dataType: "json",
                success: function(response){ //el response es el objeto que vi en POSTMAN la respuesta en JSON
                    //aqui llega la respuesta el JSON

                    // 1º  ----pinto en consola-----
                    //console.log(response)

                    //2º  ----muestro un parrafo en el contenedor del div creado  por la id resultado.----
                    //$('#resultado').html('<p>Hola, el js funciona </p>')

                    //3º  --- ahora filtro  que cliente  quiero mostrar en  la  posicion----
                    //let cliente= response.resultados[0];

                    //--- aqui elijo que datos quiero mostrar/pintar llamando a cliente siempre---
                    //let html= `

                        //<p> 
                            //<strong>Nombre:</strong> ${cliente.nombre}<br>
                            //<strong>direccion:</strong> ${cliente.direccion}
                        //</p>    
                    //`;

                    //---muestro los dos clientes en parrafos con su nombre y direccion
                    //$('#resultado').html(html)

                    
                    //guardamos  el array de clientes traidos del back, en la variable local
                    clientesGlobal=response.resultados;
                    //4º  ---creamos un acumulador para no sobrescribir cada vuelta el cliente---
                    let html = "";
                    let contador = 1;
                    //recorremos el array "response.resultados" con cada cliente
                    response.resultados.forEach(function(cliente){
                         
                        //con el acumulador creado vamos añadiendo al html cada iteraccion del bucle un cliente 
                        html += `
                            <tr>
                                <td>${contador}</td> 
                                <td>${cliente.nombre}</td>
                                <td>${cliente.direccion}</td>
                                <td>${cliente.localidad}</td>
                                <td>${cliente.cp}</td>
                                <td>
                                    <a href="#" class="btn-small blue ver-cliente" data-id="${cliente.id}"> 
                                        <i class="material-icons">Ver</i>
                                    </a>
                                    
                                    <a href="#" class="btn-small orange editar-cliente" data-id="${cliente.id}">
                                        <i class="materialize-icons">Editar</i>
                                    </a>
                                    
                                    <a href="#" class="btn-small red eliminar-cliente" data-id="${cliente.id}">
                                        <i class="materialize-icons">Borrar</i>
                                    </a>    

                                    
                                </td>


                            </tr>     
                        `;

                        contador ++;
                    });
                    
                    $('#tabla-clientes').html(html); // este es el pincel de js con el que mostramos en pantalla los resultados
                }
               
              //cierre de ajax
            })

          //inicializamos el modal, por que si no no existe
          $('.modal').modal();

          //------------------------------------------------------------
          //funcion comprobar que funciona el boton y muestra el ID(VER)
          $(document).on('click', '.ver-cliente', function(e){
            e.preventDefault();

            let id=$(this).data('id');
            
            let cliente=clientesGlobal.find(c => c.id == id);
            //ahora pintamos los datos del modal cogiendo la id que creamos en el html
            $('#m-nombre').text(cliente.nombre);
            $('#m-direccion').text(cliente.direccion);
            $('#m-localidad').text(cliente.localidad);
            $('#m-cp').text(cliente.cp);

            //abrimos el modal con el id creado arriba en el html
            $('#modal-cliente').modal('open');
          });

          //--------------------------------------------------------------
          //funcion comprobar que funciona el boton y muestra el ID(EDITAR)
          $(document).on('click', '.editar-cliente', function(e){
            e.preventDefault();

            let id= $(this).data('id');
            console.log('editar cliente con  ID:' , id)
          });

          //----------------------------------------------------------------
          //funcion comprobar que funciona el boton y muestra el ID(ELIMINAR)
          $(document).on('click', '.eliminar-cliente', function(e){
            e.preventDefault();

            let id=$(this).data('id');
            console.log('eliminando cliente con ID: ', id)
          });
        
        
        
          //cierre de la funcion de carga $(document).rea..
        })

        

        
    </script>
</body>
</html>